<!DOCTYPE html>
<html lang="ko" data-fold="true">
    <head>
        <script src="/statics/js/loadHTML.js"></script>
        <script>
            loadHTML("/statics/include/head.html");
        </script>
        <title>통합검색결과</title>
    </head>

    <body>
        <div class="wrapper">
            <script>
                loadHTML("/statics/include/nav.html");
            </script>
            
            <main class="main">
                <!-- 상단 헤더 -->
                <script>
                    loadHTML("/statics/include/sub_header.html");
                </script>
                <!-- // 상단헤더 -->
                <div class="container flex--row flex-align--start">
                    <!-- 메인 컨텐츠 -->
                    <div class="main-content">
                        <!-- 통합검색 -->
                        <div class="accordion is-active">
                            <div class="accordion__header">
                                <p class="font-weight--medium body--large">문서목록(<span class="is-primary">20</span>)</p>
                                <img src="/statics/icon/angle-down.svg"
                                class="icon">
                            </div>
                            <div class="accordion__body">
                                <div class="table">
                                    <div class="table__tbody">
                                        <div class="table__tr">
                                            <div class="table__td is-left width-90">
                                                <div class="table__td width-10 ">
                                                    <div class="icon-with-text">
                                                        <img src="/statics/icon/document-line.svg" class="icon"></img>
                                                        서식관리
                                                    </div>
                                                </div>
                                                <div class="table__td width-80">
                                                    <p class="font-weight--medium">해촉증명서</p>
                                                </div>
                                                <div class="table__td width-10">
                                                    <div class="icon-with-text">
                                                        <img src="/statics/icon/folder-line.svg" class="icon"></img>
                                                        기본폴더
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="table__td is-right width-10 flex-justify--center">
                                                <img src="/statics/icon/pop-out-line.svg" class="icon">
                                            </div>
                                        </div>
                                        <div class="table__tr">
                                            <div class="table__td is-left width-90">
                                                <div class="table__td width-10 ">
                                                    <div class="icon-with-text">
                                                        <img src="/statics/icon/document-line.svg" class="icon"></img>
                                                        서식관리
                                                    </div>
                                                </div>
                                                <div class="table__td width-80">
                                                    <p class="font-weight--medium">해촉증명서</p>
                                                </div>
                                                <div class="table__td width-10">
                                                    <div class="icon-with-text">
                                                        <img src="/statics/icon/folder-line.svg" class="icon"></img>
                                                        기본폴더
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="table__td is-right width-10 flex-justify--center">
                                                <img src="/statics/icon/pop-out-line.svg" class="icon">
                                            </div>
                                        </div>
                                        <div class="table__tr">
                                            <div class="table__td is-left width-90">
                                                <div class="table__td width-10 ">
                                                    <div class="icon-with-text">
                                                        <img src="/statics/icon/document-line.svg" class="icon"></img>
                                                        서식관리
                                                    </div>
                                                </div>
                                                <div class="table__td width-80">
                                                    <p class="font-weight--medium">해촉증명서</p>
                                                </div>
                                                <div class="table__td width-10">
                                                    <div class="icon-with-text">
                                                        <img src="/statics/icon/folder-line.svg" class="icon"></img>
                                                        기본폴더
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="table__td is-right width-10 flex-justify--center">
                                                <img src="/statics/icon/pop-out-line.svg" class="icon">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 고객센터 -->
                        <div class="accordion is-active">
                            <div class="accordion__header">
                                <p class="font-weight--medium body--large">고객센터(<span class="is-primary">20</span>)</p>
                                <img src="/statics/icon/angle-down.svg"
                                class="icon">
                            </div>
                            <div class="accordion__body">
                                <div class="table">
                                    <div class="table__tbody">
                                        <div class="table__tr">
                                            <div class="table__td is-left width-90">
                                                <div class="table__td width-10 ">
                                                    <p class="is-remark">항목명</p>
                                                </div>
                                                <div class="table__td flex--column gap--sm width-90">
                                                    <p class="font-weight--medium">해촉증명서</p>
                                                    <p class="is-remark">
                                                        Lorem ipsum dolor sit amet consectetur. Velit tortor sagittis commodo mattis dui massa. Cursus adipiscing interdum euismod et sed suspendisse metus ut facilisis.
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="table__td is-right width-10 flex-justify--center">
                                                <img src="/statics/icon/pop-out-line.svg" class="icon">
                                            </div>
                                        </div>
                                        <div class="table__tr">
                                            <div class="table__td is-left width-90">
                                                <div class="table__td width-10 ">
                                                                                                        <p class="is-remark">항목명</p>

                                                </div>
                                                <div class="table__td flex--column gap--sm width-90">
                                                    <p class="font-weight--medium">해촉증명서</p>
                                                    <p class="is-remark">
                                                        Lorem ipsum dolor sit amet consectetur. Velit tortor sagittis commodo mattis dui massa. Cursus adipiscing interdum euismod et sed suspendisse metus ut facilisis.
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="table__td is-right width-10 flex-justify--center">
                                                <img src="/statics/icon/pop-out-line.svg" class="icon">
                                            </div>
                                        </div>
                                        <div class="table__tr">
                                            <div class="table__td is-left width-90">
                                                <div class="table__td width-10 ">
                                                                                                        <p class="is-remark">항목명</p>

                                                </div>
                                                <div class="table__td flex--column gap--sm width-90">
                                                    <p class="font-weight--medium">해촉증명서</p>
                                                    <p class="is-remark">
                                                        Lorem ipsum dolor sit amet consectetur. Velit tortor sagittis commodo mattis dui massa. Cursus adipiscing interdum euismod et sed suspendisse metus ut facilisis.
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="table__td is-right width-10 flex-justify--center">
                                                <img src="/statics/icon/pop-out-line.svg" class="icon">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 블로그 -->
                        <div class="accordion is-active">
                            <div class="accordion__header">
                                <p class="font-weight--medium body--large">블로그(<span class="is-primary">20</span>)</p>
                                <img src="/statics/icon/angle-down.svg"
                                class="icon">
                            </div>
                            <div class="accordion__body">
                                <div class="table">
                                    <div class="table__tbody">
                                        <div class="table__tr">
                                            <div class="table__td is-left width-90">
                                                <div class="table__td width-10 ">
                                                    <p class="is-remark">항목명</p>
                                                </div>
                                                <div class="table__td flex--column gap--sm width-90">
                                                    <p class="font-weight--medium">해촉증명서</p>
                                                    <p class="is-remark">
                                                        Lorem ipsum dolor sit amet consectetur. Velit tortor sagittis commodo mattis dui massa. Cursus adipiscing interdum euismod et sed suspendisse metus ut facilisis.
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="table__td is-right width-10 flex-justify--center">
                                                <img src="/statics/icon/pop-out-line.svg" class="icon">
                                            </div>
                                        </div>
                                        <div class="table__tr">
                                            <div class="table__td is-left width-90">
                                                <div class="table__td width-10 ">
                                                    <p class="is-remark">항목명</p>
                                                </div>
                                                <div class="table__td flex--column gap--sm width-90">
                                                    <p class="font-weight--medium">해촉증명서</p>
                                                    <p class="is-remark">
                                                        Lorem ipsum dolor sit amet consectetur. Velit tortor sagittis commodo mattis dui massa. Cursus adipiscing interdum euismod et sed suspendisse metus ut facilisis.
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="table__td is-right width-10 flex-justify--center">
                                                <img src="/statics/icon/pop-out-line.svg" class="icon">
                                            </div>
                                        </div>
                                        <div class="table__tr">
                                            <div class="table__td is-left width-90">
                                                <div class="table__td width-10 ">
                                                    <p class="is-remark">항목명</p>
                                                </div>
                                                <div class="table__td flex--column gap--sm width-90">
                                                    <p class="font-weight--medium">해촉증명서</p>
                                                    <p class="is-remark">
                                                        Lorem ipsum dolor sit amet consectetur. Velit tortor sagittis commodo mattis dui massa. Cursus adipiscing interdum euismod et sed suspendisse metus ut facilisis.
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="table__td is-right width-10 flex-justify--center">
                                                <img src="/statics/icon/pop-out-line.svg" class="icon">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /aside-content -->
                </div>
                <!-- /container -->
            </main>
        </div>

        
        <script>
            let breakpoint = 10
            
             $(function(){
                // loadData(breakpoint)
                // getUrl()
            })

            // 갯수 바뀔 때마다 테이블 새로 불러오기
            $('#count-load-table').on('change',function(){
                breakpoint = $('#count-load-table option:selected').val()
                loadData(breakpoint)
            })

            // 데이터 로드
            function loadData(breakpoint){
                $.ajax({
                    url: "/json/dummy.json",
                    type: "GET", 
                    data:{},
                    dataType: "json"
                })
                .done(function(res) {
                    let total = res.length;
                    let paginationLength = Math.ceil(Number(total) / Number(breakpoint));

                    makePagination(paginationLength);
                    makeTable(res,breakpoint)
                })
                .fail(function(xhr, status, errorThrown) {
                })
                .always(function(xhr, status) {
                });
            }
            
            // 쿼리에서 현재 페이지 위치 추출
            function makePagination(paginationLength){
                let minPage = 1;                    // 시작페이지
                // let maxPage = paginationLength;     // 최대페이지 (단, 10개 미만일 경우 total값)
                let perPage = 10;                   // 뷰에 보이는 페이지 개수
                // let currentPage = param;            // 현재 페이지 (url 추출)
                currentPage = 1
                maxPage = 10

                if(paginationLength > 10){
                    if(paginationLength % 10 > 0) {
                        minPage = Math.floor(paginationLength / 10) * 10
                        maxPage = minPage + 9
                    }
                    else{
                        maxPage = paginationLength / 10 * 10
                        minPage = maxPage - 9
                    }
                }

                for(let i = minPage; i <= maxPage; i++ ){
                    html = ''

                    i > 5 ?
                    hideViewportPaginationClass = 'is-pc' :
                    hideViewportPaginationClass = ''

                    if( i == currentPage){
                        html += `<li class="pagination__item is-active ${hideViewportPaginationClass}" data-page_num=${i}>${i}</li>`
                    }
                    else{
                        html += `
                            <li class="pagination__item ${hideViewportPaginationClass}" data-page_num=${i}>${i}</li>
                        `
                    }
                    $('#pagination-index-wrap').append(html)
                }
            }


            // 테이블 만들기
            function makeTable(data,breakpoint){

                // 이미 테이블이 생성된 경우 테이블 삭제 후 재생성
                if($('.table__tbody .table__tr').length > 0) {
                    $('.table__tbody .table__tr').remove()
                }

                for (let i = 0; i < breakpoint; i++){

                    if(i > data.length) break;
                    testClass = null

                    let friends = [];
                    for(let a = 0; a < data[i].friends.length; a++){
                        friends.push(data[i].friends[a].name)
                    }

                    if(data[i].isActive == false){
                        state = `
                            <p class="state success" >
                                <img src="/statics/icon/hourglass-line.svg" class="icon">
                                진행중
                            </p>
                        `
                        mailAlert = `
                            <p class="is-remark" >
                                수신
                            </p>
                        `
                    }
                    else{
                        state = `
                            <p class="state ban">
                                <img src="/statics/icon/ban-line.svg" class="icon">
                                만료
                            </p>
                        `
                        mailAlert = `
                            <p class="is-remark" >
                                수신안함
                            </p>
                        `
                    }

                    html = ''
                    html += `
                    <div class="table__tr ${testClass}" data-id="${data[i].index}">
                        <div class="table__td is-left width-90">
                            <div class="table__td check-area">
                                <input type="checkbox" class="checkbox"
                                id="">
                            </div>
                            <div class="table__td width-10 status-area">
                                ${state}
                            </div>
                            <div class="table__td flex--column gap--sm width-50 title-area">
                                <p class="table__td--title">${data[i].guid}</p>
                                <p class="is-remark">${friends}</p>
                            </div>
                            <div class="table__td width-10 alarm-area">
                                ${mailAlert}
                            </div>
                            <div class="table__td width-10 folder-area">
                                <p class="is-remark">
                                    <img src="/statics/icon/folder-line.svg" class="icon" alt="폴더">
                                    기본폴더
                                </p>
                            </div>
                            <div class="table__td width-15 latest-area">
                                <p class="is-remark">2022-12-31 10:59</p>
                            </div>
                        </div>
                        <div class="table__td is-right width-10 flex-justify--center">
                            <button type="button" class="button button--outline icon-button is-small">
                                <img class="icon" src="/statics/icon/ellipsis-horizontal-line.svg"
                                alt="추가메뉴">
                            </button>
                        </div>
                    </div>`
                    $('.table__tbody').append(html)
                }
            }

            // 튜토리얼 기본 숨기기
            $('#tutorial-wrap').hide()


            // 전체 동의
            $('#checkbox-all').on('click',manageAllCheck)

            function manageAllCheck(){
                $(this).prop('checked')==true ?
                $('.checkbox').prop('checked',true) :
                $('.checkbox').prop('checked',false)
            }

            // 체크박스 이벤트
            $(document).on('click','.checkbox',function(){
                let count = $('.checkbox').filter(':checked').length;
                checkEvent(count)
            })

            function checkEvent(count){
                if(count && count > 0){
                    $('.table-top').addClass('is-active')
                    $('#default-top-box').addClass('is-hide')
                    $('#selected-top-box').removeClass('is-hide')

                    $('#selected-count').text(`(${count})`)

                    $('#document-delete').on('click',function(){
                        title = '선택한 문서'
                        makeDeleteModal(title)
                    })
                }
                else{
                    $('.checkbox').prop('checked',false)
                    $('.table-top').removeClass('is-active')
                    $('#default-top-box').removeClass('is-hide')
                    $('#selected-top-box').addClass('is-hide')
                }
            }

            $('#cancel-selected').on('click',function(){
                checkEvent(null)
            })

            // 폴더변경 클릭 이벤트
            $('#change-folder, #document-move, #document-move-this').on('click',makeFolderModal)

            function makeFolderModal(){
                html = '';
                html += `
                <div class="modal">
                    <div class="modal__header">
                        <p class="modal__title">
                            <img src="/statics/icon/exclamation-triangle-line.svg" alt="닫기" class="icon is-large icon--warning">
                            폴더 선택
                        </p>
                        <button type="button" class="icon-button">
                            <img src="/statics/icon/close-line.svg" alt="닫기" class="icon modal__close-button">
                        </button>
                    </div>
                    <div class="modal__content">
                        <div class="modal__search-form">
                            <input type="text" class="input is-large"
                            placeholder="검색어를 입력해주세요">
                            <img class="icon icon" src="/statics/icon/search-line.svg" alt="검색">
                        </div>
                        <ul class="modal__list">
                            <li class="list__item is-active"> 
                                <img class="icon " src="/statics/icon/folder-open-solid.svg" alt="현재폴더">
                                전체 폴더 보기
                            </li>
                            <li class="list__item "> 
                                <img class="icon " src="/statics/icon/folder-line.svg" alt="현재폴더">
                                기본 폴더
                            </li>
                            <li class="list__item" data-id="${0}"> 
                                <img class="icon " src="/statics/icon/folder-line.svg" alt="현재폴더">
                                기존 사용 서식
                                <div class="flex--row flex-align--center">
                                    <button type="button">삭제</button>
                                    <button type="button">완료</button>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="modal__footer">
                        <button type="button" class="button--primary button--large"
                        id="create-new-folder">새 폴더 추가하기</button>
                    </div>
                </div>
                `
                $('.main').append(html)
            }

            // 새 폴더 만들기
            $(document).on('click','#create-new-folder',createNewFolder)
            function createNewFolder(){
                html = '';
                html += `
                    <div class="flex--row">
                        <input type="text" class="input">
                        <button type="button" id="cancel-new-folder">취소</button>
                        <button type="button" id="submit-new-folder">완료</button>
                    </div>
                `
                $('.modal__list').append(html)

                $('#cancel-new-folder').on('click',function(){
                    $(this).parents('.flex--row').remove()
                })
                $('#submit-new-folder').on('click',function(){
                    if($(this).siblings('.input').val().length < 1){
                        alert('폴더명을 입력해주세요')
                    }
                    else{
                        $(this).parents('.flex--row').remove()
                        $('.modal__list').append(`
                            <li class="flex--row flex-align--center"> 
                                <img class="icon " src="/statics/icon/folder-line.svg" alt="현재폴더">
                                ${$(this).siblings('.input').val()}
                            </li>
                        `)
                    }
                })
            }
            
            // 폴더 변경하기
            function changeFolder(){
                $.ajax({
                    url: "/json/dummy.json",
                    type: "GET", 
                    data:{},
                    dataType: "json"
                })
                .done(function(res) {
                    makeTable(res)
                })
                .fail(function(xhr, status, errorThrown) {
                })
                .always(function(xhr, status) {
                });
            }


            // 더보기 버튼 클릭
            function makeMoreEvent(){
                const documentId =$(this).attr('data-id')
                html = '';
                html += `
                <ul class="list-modal">
                    <li id="document-name-change-this">문서이름변경</li>
                    <li id="document-download-this">다운로드</li>
                    <li id="document-move-this">폴더이동</li>
                    <li id="document-delete-this">삭제</li>
                </ul>
                `
                if($('.table__tr .list-modal').length < 1){
                    $(this).append(html)
                    $(this).parents('.table__tr').css('z-index','10')
                }
                else{
                    $('.table__tr').css('z-index','0')
                    $('.table__tr .list-modal').remove()
                }

                $('#document-name-change-this').on('click',makeDeleteModal)
                $('#document-download-this').on('click',makeDeleteModal)
                $('#document-move-this').on('click',makeFolderModal)
                $('#document-delete-this').on('click',function(){
                    const documentTitle = $(this).parents('.table__tr').find('.doc-header__title').text()
                    makeDeleteModal(documentTitle)
                })
            }

            $(document).on('click','.table__tbody .table__tr .button--outline',makeMoreEvent)

            // 삭제 이벤트
            function makeDeleteModal(string){
                html = '';
                html += `
                <div class="modal">
                    <div class="modal__header">
                        <p class="modal__title">
                            <img src="/statics/icon/exclamation-triangle-line.svg" alt="닫기" class="icon is-large icon--warning">
                            휴지통으로 보내기
                        </p>
                        <button type="button" class="icon-button">
                            <img src="/statics/icon/close-line.svg" alt="닫기" class="icon modal__close-button">
                        </button>
                    </div>
                    <div class="modal__content">
                        <p>
                            <span class="font-weight--medium">${string}</span>
                            를 휴지통으로 보낼까요?
                        </p>
                    </div>
                    <div class="modal__footer">
                        <button type="button" class="button--primary button--large">확인</button>
                    </div>
                </div>
                `
                $('.main').append(html)
            }

            $(document).on('click','.table__tr',makeAsideContent)

            function makeAsideContent(e){

                // thead 영역일 경우 aisde 생성 안함
                if($(this).parent('.table__thead').length > 0){
                    if(e.target.className !== 'checkbox'){
                        return false;
                    }
                    else{
                        return
                    }
                }


                if(e.target.closest('button')||e.target.closest('.list-modal')) return false;
                else if ($('.aside-content .container').length > 0){
                    $('.aside-content').toggleClass('is-active')
                }
                else{
                    return false;
                }
                
                // $('.aside-content').css({'height':$('.main > .container').outerHeight()})

                let userId = $(this).attr('data-id')
                loadAsideData(userId)
            }

            // 문서이력
            function loadAsideData(userId){
                $.ajax({
                    url: "/json/dummy.json",
                    type: "GET", 
                    data:{},
                    dataType: "json"
                })
                .done(function(res) {
                    const result = res.find(item => item.index == userId)
                    
                    let title = '문서이력'
                    let html = ''

                    if($('.aside-list__item').length > 0){
                        $('.aside-list__item').remove()
                    }

                    for(let i = 0; i < 3; i++){
                        html += `
                        <li class="aside-list__item">
                            <p class="font-weight--medium">
                                ${result.friends[i].name}
                            </p>
                            <p class="">
                                ${result.email}
                            </p>
                            <p class="body--small">${result.registered.substr(0,10)}</p>
                        </li>
                            `
                    }
                    $('#aside-summary').append(html)
                })
                .fail(function(xhr, status, errorThrown) {
                })
                .always(function(xhr, status) {
                });
            }

        </script>
        <!-- <script src="/statics/js/tutorial.js"></script> -->
        <script src="/statics/js/common.js"></script>
    </body>
    
</html>